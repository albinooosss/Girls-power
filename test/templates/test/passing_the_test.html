{% extends 'test/base.html' %}
{% block title %}Passing tests{% endblock %}
{% block content %}
    <h1>{{ test.name }}</h1>
    <p id="countdown">Time left: {{ time_for_pass }}</p>
    <form id="testForm" method="post" action="/test/{{ test.id }}/results/">
        {% csrf_token %}
        {% for question in questions %}
            <h2>{{ question.name }}</h2>
            {% for answer in question.answer_set.all %}
                <div class="form-check">
                    <input type="checkbox"
                           name="answer_{{ question.id }}"
                           class="form-check-input"
                           id="answer{{ answer.id }}"
                           value="{{ answer.id }}"
                           {% if answer.id in user_answers %}checked{% endif %}>
                    <label for="answer{{ answer.id }}" class="form-check-label">{{ answer.name }}</label>
                </div>
            {% endfor %}
            <br>
        {% endfor %}
        <button type="submit" class="btn btn-primary">Check</button>
    </form>

    <script>
    var countdownElement = document.getElementById('countdown');
    var timeLeft = {{ time_for_pass }} * 60; // Конвертируем минуты в секунды
    var countdown = setInterval(function() {
        timeLeft--;
        var minutes = Math.floor(timeLeft / 60);
        var seconds = timeLeft % 60;
        countdownElement.textContent = "Time left: " + minutes + "m " + seconds + "s";
        if (timeLeft <= 0) {
            clearInterval(countdown);
            document.getElementById('testForm').submit(); // Отправляем форму при истечении времени
        }
    }, 1000);
    </script>
{% endblock %}
